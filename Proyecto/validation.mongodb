use('techstore');

db.productos?.drop();

db.createCollection('productos', {
    validator: {
        $jsonSchema: {
            bsonType: 'object',
            required: [
                'sku',
                'nombre',
                'precio',
                'stock',
                'tipo_producto',
                'fecha_creacion',
                'especificaciones'
            ],
            properties: {
                sku: {
                    bsonType: 'string',
                    description: 'dos letras mayúsculas seguidas de cuatro números (ej. AB1234)',
                    pattern: '^[A-Z]{2}[0-9]{4}$'
                },
                nombre: {
                    bsonType: 'string',
                    minLength: 3
                },
                precio: {
                    bsonType: 'double',
                    minimum: 0
                },
                stock: {
                    bsonType: 'int',
                    minimum: 0
                },
                tipo_producto: {
                    bsonType: 'string',
                    enum: [
                        'Smartphone',
                        'Laptop',
                        'Monitor',
                        'Accesorio',
                        'Tablet',
                        'Audio',
                        'Otro'
                    ]
                },
                fecha_creacion: {
                    bsonType: 'date'
                },
                especificaciones: {
                    bsonType: 'object',
                    additionalProperties: true,
                    minProperties: 1
                }, ultima_revision: {
                    bsonType: ['date', 'null'],
                
                },
            }
        }
    },

});


db.productos.createIndex({ sku: 1 }, { unique: true, name: 'uq_sku' });
